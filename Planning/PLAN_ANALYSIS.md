# One Message 프로젝트 과금 및 플랜 구조 분석

현재 프로젝트(One Message)의 과금 요소와 사용자 플랜 구조를 분석한 내용입니다. 분석은 `CLAUDE.md`, 데이터베이스 마이그레이션 파일(`008_create_user_subscriptions.sql`), 그리고 소스 코드(`iap_service_impl.dart`, `subscription.dart`)를 기반으로 수행되었습니다.

---

## 1. 사용자 등급 (User Tiers)

시스템은 총 3단계의 사용자 등급으로 구성되어 있습니다.

### 1) 게스트 (Guest / Non-login)
*   **대상**: 로그인하지 않은 사용자
*   **데이터 제공 로직**: 완전 무작위 (중복 허용)
*   **제공 수량**: 하루 1개
*   **제한 사항**:
    *   기도 노트 작성 불가
    *   말씀 아카이빙(저장) 불가

### 2) 멤버 (Member / Free)
*   **대상**: 회원가입/로그인한 무료 사용자
*   **데이터 제공 로직**: 중복 없음 (이미 본 말씀 제외)
*   **제공 수량**: 하루 3개 (3개 소진 시 다음 날까지 대기)
*   **기능 권한**:
    *   **기도 노트**: 작성 가능, 최근 3일치 기록만 조회 가능
    *   **아카이빙**: 최근 7일간의 기록만 저장 (자동 삭제 정책 적용 예정)

### 3) 프리미엄 (Premium / Paid)
*   **대상**: 유료 구독 사용자
*   **데이터 제공 로직**: 중복 없음 + 프리미엄 전용 DB 접근 권한
*   **제공 수량**: 기본 3개 + '말씀 3개 더 받기' 버튼 활성화 (총 6개 이상 가능)
*   **기능 권한**:
    *   **기도 노트**: 무제한 조회 및 수정 (모든 과거 기록 접근 가능)
    *   **아카이빙**: 영구적인 무제한 저장소 제공

---

## 2. 구독 상품 구성 (Subscription Products)

데이터베이스(`subscription_products` 테이블)에 정의된 상품 구성은 다음과 같습니다.

| 상품명 | 설명 | 기간 | 가격 (KRW) | 가격 (USD) | Store ID (iOS) | Store ID (Android) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **월간 구독** (Monthly Premium) | 모든 프리미엄 기능 1개월 이용 | 30일 | ₩9,900 | $9.99 | `com.onemessage.monthly` | `monthly_premium_sub` |
| **연간 구독** (Annual Premium) | 모든 프리미엄 기능 1년 이용 (2개월 무료 효과) | 365일 | ₩99,000 | $99.00 | `com.onemessage.annual` | `annual_premium_sub` |

> **참고**: 연간 구독은 월간 구독 대비 약 17% 할인이 적용된 가격(2개월 무료)으로 책정되어 있습니다.

---

## 3. 시스템 구현 현황

### 데이터베이스 (Supabase)
*   **`subscription_products` 테이블**: 위에서 언급한 구독 상품 정보가 정의되어 있습니다. RLS(Row Level Security) 정책에 따라 누구나 조회(`SELECT`)할 수 있습니다.
*   **`user_subscriptions` 테이블**: 사용자의 실제 구독 상태를 관리합니다.
    *   상태값: `active`(활성), `canceled`(취소됨), `expired`(만료됨), `pending`(대기), `grace_period`(유예 기간)
    *   User ID와 Product ID를 매핑하여 관리합니다.

### 코드 (Flutter)
*   **In-App Purchase (IAP)**: `in_app_purchase` 패키지를 사용하여 구현되어 있습니다.
*   **비즈니스 로직**:
    *   Android/iOS 플랫폼별로 다른 Product ID를 처리하도록 분기 처리되어 있습니다.
    *   `Subscription` 엔티티는 불변 객체(Immutable)로 설계되어 있으며, 상태(`active`, `expired` 등)를 관리합니다.

### 수익화 포인트 (Upselling Points)
앱 내에서 다음과 같은 상황에 유료 전환을 유도하도록 설계되어 있습니다.
1.  **아카이브 제한 도달 시**: 멤버 등급 사용자가 3일 지난 기록을 보려고 할 때
2.  **콘텐츠 소진 시**: 하루 제공량(3개)을 모두 읽고 더 많은 말씀을 원할 때

---

## 4. 결론 및 요약

*   **구조**: **Guest → Member → Premium**의 명확한 3단계 프리미엄(Freemium) 모델
*   **핵심 차별점**: 데이터의 **양**(1개 vs 3개 vs 추가제공)과 **보존 기간**(저장 불가 vs 7일 vs 영구)
*   **가격 정책**: 월 9,900원 / 연 99,000원 (심플한 구성)
